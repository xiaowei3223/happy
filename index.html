<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <title>自动农历生日示例</title>
  <!-- ✅ 引入 solarlunar CDN -->
  <script src="https://cdn.jsdelivr.net/npm/solarlunar@3.0.0/dist/solarlunar.min.js"></script>

  <script>
    // ---------------------- 公用函数 ----------------------
    function GetDateDiffstart(startTime) {
      startTime = startTime.replace(/\-/g, "/");
      var sTime = new Date(startTime);
      var eTime = new Date();
      var timeType = 1000 * 3600 * 24;
      var diffday = parseInt((eTime - sTime) / timeType);
      return diffday >= 0 ? diffday : -diffday;
    }

    function getNextCelebrateNumber(currentDays, step) {
      return Math.ceil(currentDays / step) * step;
    }

    function DateAdd(interval, number, date) {
      if (interval === "d") {
        date.setDate(date.getDate() + number);
      }
      return date;
    }

    function getCelebrateDay(startTime, days) {
      startTime = startTime.replace(/\-/g, "/");
      var sTime = new Date(startTime);
      var newDate = DateAdd("d", days, sTime);
      return newDate.toLocaleDateString();
    }

    function GetDateDiffend(EndTime) {
      EndTime = EndTime.replace(/\-/g, "/");
      var sTime = new Date(EndTime);
      var eTime = new Date();
      var timeType = 1000 * 3600 * 24;
      var diffday = parseInt((sTime - eTime) / timeType);
      return diffday >= 0 ? diffday : -diffday;
    }

    // ---------------------- 自动农历转公历 ----------------------
    function getNextLunarBirthday(lunarMonth, lunarDay) {
      const today = new Date();
      const currentYear = today.getFullYear();

      // 今年的农历转公历
      let solar = solarlunar.lunar2solar(currentYear, lunarMonth, lunarDay, false);
      let solarDate = new Date(`${solar.cYear}-${pad(solar.cMonth)}-${pad(solar.cDay)}`);

      if (solarDate >= today) {
        return `${solar.cYear}-${pad(solar.cMonth)}-${pad(solar.cDay)}`;
      } else {
        // 今年已过，用明年
        let nextSolar = solarlunar.lunar2solar(currentYear + 1, lunarMonth, lunarDay, false);
        return `${nextSolar.cYear}-${pad(nextSolar.cMonth)}-${pad(nextSolar.cDay)}`;
      }
    }

    // 补零
    function pad(n) {
      return n < 10 ? '0' + n : n;
    }

  </script>
</head>

<body>
<center>
<h1>好好学习，天天向上</h1>
<hr>

<table border="" cellspacing="" cellpadding="" style="background-color: #e5ffe5; width: 80%;">
<tr>
<td width="50%" style="padding: 32px;">
<div>
<p>现在是 
    <span style="color:#00ccff;"> 
        <script>document.write(new Date().toLocaleString())</script>
    </span>
</p>

<hr>

<h2 style="text-align: center;">相识与恋爱</h2>
<p>2018年11月27日认识，已认识
    <span style="color:#00ccff; font-size:24px;"> 
        <script>
        var rsDays = GetDateDiffstart("2018/11/27");
        document.write(rsDays);
        </script>
    </span> 天
</p>
<p>下一个整数百天纪念日是第
    <span style="color:#00ccff; font-size:24px;">
        <script>
        var nextRs = getNextCelebrateNumber(rsDays, 100);
        document.write(nextRs);
        </script>
    </span> 天（即
    <span style="color:#00ccff; font-size:24px;">
        <script>
        document.write(getCelebrateDay("2018/11/27", nextRs));
        </script>
    </span>，距离还有
    <span style="color:#00ccff; font-size:24px;">
        <script>
        document.write(nextRs - rsDays);
        </script>
    </span> 天)
</p>

<hr>

<p>2019年2月14日成为恋人，已恋爱
    <span style="color:#00ccff; font-size:24px;"> 
        <script>
        var laDays = GetDateDiffstart("2019/02/14");
        document.write(laDays);
        </script>
    </span> 天
</p>
<p>下一个整数百天纪念日是第
    <span style="color:#00ccff; font-size:24px;">
        <script>
        var nextLa = getNextCelebrateNumber(laDays, 100);
        document.write(nextLa);
        </script>
    </span> 天（即
    <span style="color:#00ccff; font-size:24px;">
        <script>
        document.write(getCelebrateDay("2019/02/14", nextLa));
        </script>
    </span>，距离还有
    <span style="color:#00ccff; font-size:24px;">
        <script>
        document.write(nextLa - laDays);
        </script>
    </span> 天)
</p>

<hr>

<h2 style="text-align: center;">生日倒计时（自动农历转公历）</h2>
<p>公子萧兮下一个（农历六月十四）生日：
    <span style="color:#00ccff; font-size:24px;">
        <script>
        var gxNext = getNextLunarBirthday(6, 14);
        document.write(gxNext);
        </script>
    </span>，距离还有
    <span style="color:#00ccff; font-size:24px;">
        <script>
        document.write(GetDateDiffend(gxNext) + " 天");
        </script>
    </span>
</p>

<p>远志下一个（农历一月十三）生日：
    <span style="color:#00ccff; font-size:24px;">
        <script>
        var yzNext = getNextLunarBirthday(1, 13);
        document.write(yzNext);
        </script>
    </span>，距离还有
    <span style="color:#00ccff; font-size:24px;">
        <script>
        document.write(GetDateDiffend(yzNext) + " 天");
        </script>
    </span>
</p>

</div>
</td>
</tr>
</table>
</center>
</body>
</html>
